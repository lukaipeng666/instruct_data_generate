# BowenGen - åˆ†å¸ƒå¼æ•°æ®ç”Ÿæˆä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åˆ†å¸ƒå¼å¯¹è¯æ•°æ®ç”Ÿæˆå¹³å°ï¼Œæ”¯æŒå¤šæœåŠ¡å¹¶è¡Œå¤„ç†ï¼Œæä¾›å®Œæ•´çš„ Web ç®¡ç†ç•Œé¢ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **åˆ†å¸ƒå¼æ•°æ®ç”Ÿæˆ**ï¼šæ”¯æŒå¤šä¸ª vLLM/OpenAI å…¼å®¹æœåŠ¡å¹¶è¡Œå¤„ç†ï¼Œæœ€å¤§åŒ–æ•°æ®ç”Ÿæˆæ•ˆç‡
- **ä»»åŠ¡ç®¡ç†**ï¼šä»»åŠ¡åˆ›å»ºã€å®æ—¶è¿›åº¦ç›‘æ§ã€ä»»åŠ¡åœæ­¢ä¸åˆ é™¤
- **æ¨¡å‹ç®¡ç†**ï¼šæ”¯æŒé…ç½®å¤šä¸ªæ¨¡å‹æœåŠ¡ï¼Œçµæ´»åˆ‡æ¢
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šå®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†ï¼ˆç®¡ç†å‘˜/æ™®é€šç”¨æˆ·ï¼‰
- **æ•°æ®ç®¡ç†**ï¼šæ–‡ä»¶ä¸Šä¼ ã€æ•°æ®é¢„è§ˆã€ç”Ÿæˆç»“æœå¯¼å‡º
- **å®æ—¶è¿›åº¦**ï¼šåŸºäº Redis çš„ä»»åŠ¡è¿›åº¦è¿½è¸ªï¼Œæ”¯æŒ SSE å®æ—¶æ¨é€
- **æ•°æ®è´¨é‡è¯„ä¼°**ï¼šè‡ªåŠ¨è¯„åˆ†æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿæˆæ•°æ®è´¨é‡

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React å‰ç«¯    â”‚â”€â”€â”€â”€â–¶â”‚  FastAPI åç«¯   â”‚â”€â”€â”€â”€â–¶â”‚   vLLM æœåŠ¡     â”‚
â”‚   (Port 3000)   â”‚     â”‚   (Port 5000)   â”‚     â”‚  (å¤šæœåŠ¡å¹¶è¡Œ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼            â–¼            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  SQLite  â”‚ â”‚  Redis   â”‚ â”‚  æ—¥å¿—    â”‚
              â”‚  æ•°æ®åº“  â”‚ â”‚  ç¼“å­˜    â”‚ â”‚  ç³»ç»Ÿ    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡¹ç›®ç»“æ„

```
bowengen/
â”œâ”€â”€ app/                          # åç«¯åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ app.py                    # FastAPI ä¸»å…¥å£
â”‚   â”œâ”€â”€ routes/                   # è·¯ç”±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth_routes.py        # è®¤è¯ç›¸å…³è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ data_routes.py        # æ•°æ®ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ task_routes.py        # ä»»åŠ¡ç®¡ç†è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ model_routes.py       # æ¨¡å‹é…ç½®è·¯ç”±
â”‚   â”‚   â””â”€â”€ admin_routes.py       # ç®¡ç†å‘˜è·¯ç”±
â”‚   â””â”€â”€ services/                 # æœåŠ¡å±‚
â”‚       â””â”€â”€ task_manager.py       # ä»»åŠ¡ç®¡ç†å™¨
â”œâ”€â”€ call_model/                   # æ¨¡å‹è°ƒç”¨æ¨¡å—
â”‚   â””â”€â”€ model_call.py             # ç»Ÿä¸€æ¨¡å‹è°ƒç”¨æ¥å£
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml               # ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ prompt_config.py          # æç¤ºè¯é…ç½®
â”‚   â””â”€â”€ tools.py                  # å·¥å…·å‡½æ•°
â”œâ”€â”€ database/                     # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ models.py                 # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ auth.py                   # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ file_service.py           # æ–‡ä»¶æœåŠ¡
â”‚   â”œâ”€â”€ user_service.py           # ç”¨æˆ·æœåŠ¡
â”‚   â””â”€â”€ generated_data_service.py # ç”Ÿæˆæ•°æ®æœåŠ¡
â”œâ”€â”€ develop/                      # æ ¸å¿ƒç”Ÿæˆæ¨¡å—
â”‚   â”œâ”€â”€ pipeline_gen.py           # åˆ†å¸ƒå¼ç®¡é“ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ single_gen.py             # å•æœåŠ¡æ•°æ®ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ file_reader.py            # æ–‡ä»¶è¯»å–å™¨
â”‚   â””â”€â”€ report_generator.py       # æŠ¥å‘Šç”Ÿæˆå™¨
â”œâ”€â”€ frontend/                     # å‰ç«¯é¡¹ç›® (React + Vite)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/           # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/                # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/             # API æœåŠ¡
â”‚   â”‚   â””â”€â”€ store/                # çŠ¶æ€ç®¡ç† (Zustand)
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ main.py                       # å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ start.sh                      # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop.sh                       # åœæ­¢è„šæœ¬
â””â”€â”€ requirements.txt              # Python ä¾èµ–
```

## ç¯å¢ƒè¦æ±‚

### åç«¯
- Python 3.10+
- **Redis** (å¿…éœ€ï¼Œç”¨äºä»»åŠ¡è¿›åº¦è¿½è¸ªå’Œæ¨¡å‹è°ƒç”¨é™æµ)

### å‰ç«¯
- Node.js 16+
- npm æˆ– yarn

### æ¨¡å‹æœåŠ¡
- vLLM æˆ–ä»»ä½• OpenAI å…¼å®¹çš„ API æœåŠ¡

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone ssh://git@code.in.wezhuiyi.com:60022/nlp-algorithm/bowenability/bowengen.git
cd bowengen
git checkout v.2.0.1
```

### 2. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv venv
source venv/bin/activate  # Linux/macOS
# venv\Scripts\activate    # Windows

# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install
cd ..
```

### 3. å®‰è£… Redis

Redis æ˜¯ç³»ç»Ÿå¿…éœ€ç»„ä»¶ï¼Œç”¨äºä»»åŠ¡è¿›åº¦è¿½è¸ªå’Œæ¨¡å‹è°ƒç”¨é™æµã€‚è¯·æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿé€‰æ‹©å®‰è£…æ–¹å¼ï¼š

#### macOS

**ä½¿ç”¨ Homebrewï¼ˆæ¨èï¼‰**ï¼š
```bash
# å®‰è£… Redis
brew install redis

# å¯åŠ¨ Redis æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
brew services start redis

# æˆ–æ‰‹åŠ¨å¯åŠ¨ï¼ˆå‰å°è¿è¡Œï¼‰
redis-server
```

**éªŒè¯å®‰è£…**ï¼š
```bash
redis-cli ping
# åº”è¿”å›: PONG
```

#### Linux (Ubuntu/Debian)

```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£… Redis
sudo apt install redis-server

# å¯åŠ¨ Redis æœåŠ¡
sudo systemctl start redis-server

# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰
sudo systemctl enable redis-server

# éªŒè¯å®‰è£…
redis-cli ping
# åº”è¿”å›: PONG
```

#### Linux (CentOS/RHEL)

```bash
# å®‰è£… EPEL ä»“åº“ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo yum install epel-release

# å®‰è£… Redis
sudo yum install redis

# å¯åŠ¨ Redis æœåŠ¡
sudo systemctl start redis

# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰
sudo systemctl enable redis

# éªŒè¯å®‰è£…
redis-cli ping
# åº”è¿”å›: PONG
```

#### Windows

**æ–¹æ³• 1ï¼šä½¿ç”¨ WSL2ï¼ˆæ¨èï¼‰**

åœ¨ WSL2 ä¸­æŒ‰ç…§ Linux å®‰è£…æ­¥éª¤æ“ä½œã€‚

**æ–¹æ³• 2ï¼šä½¿ç”¨ Memuraiï¼ˆRedis çš„ Windows æ›¿ä»£å“ï¼‰**

1. è®¿é—® [Memurai å®˜ç½‘](https://www.memurai.com/)
2. ä¸‹è½½å¹¶å®‰è£… Memurai Developer Editionï¼ˆå…è´¹ï¼‰
3. å®‰è£…åä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡

**æ–¹æ³• 3ï¼šä½¿ç”¨ Docker**

```bash
# æ‹‰å– Redis é•œåƒ
docker pull redis

# è¿è¡Œ Redis å®¹å™¨
docker run -d -p 6379:6379 --name redis redis

# éªŒè¯å®‰è£…
docker exec -it redis redis-cli ping
# åº”è¿”å›: PONG
```

#### éªŒè¯ Redis è¿æ¥

å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ Redis æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
# æµ‹è¯•è¿æ¥
redis-cli ping

# å¦‚æœè¿”å› PONGï¼Œè¯´æ˜ Redis è¿è¡Œæ­£å¸¸
# å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š
# 1. Redis æœåŠ¡æ˜¯å¦å·²å¯åŠ¨
# 2. ç«¯å£ 6379 æ˜¯å¦è¢«å ç”¨
# 3. é˜²ç«å¢™è®¾ç½®æ˜¯å¦å…è®¸è¿æ¥
```

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœä½¿ç”¨ `./start.sh` å¯åŠ¨è„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶å°è¯•å¯åŠ¨ Redisï¼ˆå¦‚æœå·²å®‰è£…ä½†æœªè¿è¡Œï¼‰ã€‚

### 4. é…ç½®

æ‰€æœ‰é…ç½®é¡¹é›†ä¸­åœ¨ `config/config.yaml` ä¸­ç®¡ç†ï¼š

```yaml
# æœåŠ¡é…ç½®æ–‡ä»¶

# Web æœåŠ¡é…ç½®
web_service:
  host: "0.0.0.0"
  port: 5000

# å‰ç«¯é…ç½®
frontend:
  url: "http://localhost:3000"

# CORS é…ç½®ï¼ˆè·¨åŸŸè®¿é—®ï¼‰
cors:
  origins:
    - "http://localhost:3000"
  allow_credentials: true
  allow_methods: ["*"]
  allow_headers: ["*"]

# JWT è®¤è¯é…ç½®
jwt:
  # å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼Œç•™ç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰
  secret_key: ""
  algorithm: "HS256"
  expire_minutes: 43200  # 30å¤©

# ç®¡ç†å‘˜é…ç½®
admin:
  username: "admin"
  # å¯†ç ï¼ˆç•™ç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆéšæœºå¯†ç ï¼Œç”Ÿäº§ç¯å¢ƒè¯·è®¾ç½®å¼ºå¯†ç ï¼‰
  password: ""

# Redis æœåŠ¡é…ç½®ï¼ˆç”¨äºæ¨¡å‹è°ƒç”¨é™æµå’Œä»»åŠ¡è¿›åº¦ï¼‰
redis_service:
  host: "localhost"
  port: 6379
  db: 0
  password: null
  max_wait_time: 300
  default_max_concurrency: 16

# é»˜è®¤æ¨¡å‹æœåŠ¡é…ç½®
model_services:
  default_services:
    - "http://localhost:6466/v1"
    - "http://localhost:6467/v1"
    - "http://localhost:6468/v1"
    - "http://localhost:6469/v1"
    - "http://localhost:6470/v1"
    - "http://localhost:6471/v1"
    - "http://localhost:6472/v1"
    - "http://localhost:6473/v1"
  default_model: "/data/models/Qwen3-32B"
  default_api_key: ""
```

#### é…ç½®è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `web_service.port` | åç«¯ API ç«¯å£ |
| `frontend.url` | å‰ç«¯è®¿é—®åœ°å€ |
| `cors.origins` | å…è®¸çš„è·¨åŸŸæºåˆ—è¡¨ |
| `jwt.secret_key` | JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®å›ºå®šå€¼ï¼‰ |
| `jwt.expire_minutes` | Token è¿‡æœŸæ—¶é—´ |
| `admin.password` | é»˜è®¤ç®¡ç†å‘˜å¯†ç ï¼ˆé¦–æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨ï¼‰ |
| `redis_service.*` | Redis è¿æ¥é…ç½® |
| `model_services.default_services` | é»˜è®¤æ¨¡å‹æœåŠ¡åœ°å€åˆ—è¡¨ |

> âš ï¸ **å®‰å…¨æç¤º**ï¼šç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…è®¾ç½® `jwt.secret_key` å’Œ `admin.password`

### 5. å¯åŠ¨æœåŠ¡

```bash
# ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
./start.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
# å¯åŠ¨åç«¯
python -m uvicorn app.app:app --host 0.0.0.0 --port 5000

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend && npm run dev
```

### 6. è®¿é—®ç³»ç»Ÿ

- å‰ç«¯ç•Œé¢ï¼šhttp://localhost:3000
- API æ–‡æ¡£ï¼šhttp://localhost:5000/docs
- åç«¯ APIï¼šhttp://localhost:5000


### å‘½ä»¤è¡Œå‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--services` | localhost:6466-6473 | API æœåŠ¡åœ°å€åˆ—è¡¨ |
| `--model` | /data/models/Qwen3-32B | æ¨¡å‹è·¯å¾„ |
| `--file-id` | å¿…å¡« | æ•°æ®åº“ä¸­çš„æ–‡ä»¶ ID |
| `--user-id` | å¿…å¡« | ç”¨æˆ· ID |
| `--task-id` | å¿…å¡« | ä»»åŠ¡ ID |
| `--batch-size` | 16 | æ‰¹å¤„ç†å¤§å° |
| `--max-concurrent` | 16 | æœ€å¤§å¹¶å‘æ•° |
| `--min-score` | 8 | æœ€ä½è¯„åˆ†è¦æ±‚ (0-10) |
| `--task-type` | entity_extraction | ä»»åŠ¡ç±»å‹ |
| `--variants-per-sample` | 3 | æ¯ä¸ªæ ·æœ¬ç”Ÿæˆçš„å˜ä½“æ•° |
| `--data-rounds` | 10 | æ•°æ®ä½¿ç”¨è½®æ¬¡ |
| `--retry-times` | 3 | API è°ƒç”¨é‡è¯•æ¬¡æ•° |
| `--directions` | - | éœ€è¦æ„é€ çš„é¢˜æåˆ—è¡¨ |
| `--is-vllm` | True | æ˜¯å¦ä½¿ç”¨ vLLM æ ¼å¼ |
| `--top-p` | 1.0 | top_p é‡‡æ ·å‚æ•° |
| `--max-tokens` | 8192 | æœ€å¤§ç”Ÿæˆ token æ•° |
| `--timeout` | 600 | API è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰|

## API æ¥å£

### è®¤è¯ç›¸å…³
- `POST /api/login` - ç”¨æˆ·ç™»å½•
- `POST /api/register` - ç”¨æˆ·æ³¨å†Œ
- `GET /api/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### ä»»åŠ¡ç®¡ç†
- `POST /api/start` - å¯åŠ¨ä»»åŠ¡
- `GET /api/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `GET /api/progress/{task_id}` - è·å–ä»»åŠ¡è¿›åº¦ (SSE)
- `GET /api/task_progress/{task_id}` - è·å–ä»»åŠ¡è¿›åº¦ (JSON)
- `POST /api/stop/{task_id}` - åœæ­¢ä»»åŠ¡
- `DELETE /api/task/{task_id}` - åˆ é™¤ä»»åŠ¡

### æ•°æ®ç®¡ç†
- `POST /api/upload` - ä¸Šä¼ æ•°æ®æ–‡ä»¶
- `GET /api/files` - è·å–æ–‡ä»¶åˆ—è¡¨
- `GET /api/generated-data/{task_id}` - è·å–ç”Ÿæˆæ•°æ®
- `GET /api/export/{task_id}` - å¯¼å‡ºæ•°æ®

### æ¨¡å‹ç®¡ç†
- `GET /api/models` - è·å–æ¨¡å‹åˆ—è¡¨
- `POST /api/models` - æ·»åŠ æ¨¡å‹é…ç½®
- `PUT /api/models/{id}` - æ›´æ–°æ¨¡å‹é…ç½®
- `DELETE /api/models/{id}` - åˆ é™¤æ¨¡å‹é…ç½®

## åœæ­¢æœåŠ¡

```bash
./stop.sh
```

## æŠ€æœ¯æ ˆ

### åç«¯
- **FastAPI** - é«˜æ€§èƒ½ Web æ¡†æ¶
- **SQLAlchemy** - ORM æ•°æ®åº“æ“ä½œ
- **SQLite** - è½»é‡çº§æ•°æ®åº“
- **Redis** - ç¼“å­˜å’Œä»»åŠ¡è¿›åº¦è¿½è¸ª
- **python-jose** - JWT è®¤è¯

### å‰ç«¯
- **React 18** - UI æ¡†æ¶
- **Vite** - æ„å»ºå·¥å…·
- **TypeScript** - ç±»å‹å®‰å…¨
- **Tailwind CSS** - æ ·å¼æ¡†æ¶
- **Zustand** - çŠ¶æ€ç®¡ç†
- **Axios** - HTTP å®¢æˆ·ç«¯

## è®¸å¯è¯

å†…éƒ¨é¡¹ç›®ï¼Œä»…ä¾›æˆæƒç”¨æˆ·ä½¿ç”¨ã€‚

## æ›´æ–°æ—¥å¿—

### v2.0.1 (2024-12)
- æ–°å¢å‰åç«¯åˆ†ç¦»æ¶æ„
- æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- æ”¯æŒæ¨¡å‹é…ç½®ç®¡ç†
- å®ç°åŸºäº Redis çš„ä»»åŠ¡è¿›åº¦è¿½è¸ª
- ç”Ÿæˆæ•°æ®å­˜å‚¨åˆ° SQL æ•°æ®åº“
- ä¼˜åŒ–åˆ†å¸ƒå¼å¹¶è¡Œå¤„ç†æ€§èƒ½
